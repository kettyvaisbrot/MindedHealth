FROM python:3.9-slim

ARG SECRET_KEY
ARG DB_PASSWORD
ARG GOOGLE_SEARCH_API_KEY
ARG GOOGLE_SEARCH_CSE_ID
ARG OPENAI_API_KEY
ARG STATIC_ROOT
ARG REDIS_HOST
ARG REDIS_PORT
ARG DB_NAME
ARG DB_USER
ARG DB_PASSWORD
ARG DB_HOST
ARG DB_PORT

ENV SECRET_KEY=${SECRET_KEY}
ENV DB_PASSWORD=${DB_PASSWORD}
ENV GOOGLE_SEARCH_API_KEY=${GOOGLE_SEARCH_API_KEY}
ENV GOOGLE_SEARCH_CSE_ID=${GOOGLE_SEARCH_CSE_ID}
ENV OPENAI_API_KEY=${OPENAI_API_KEY}
ENV STATIC_ROOT=${STATIC_ROOT}
ENV REDIS_HOST=${REDIS_HOST}
ENV REDIS_PORT=${REDIS_PORT}
ENV DB_NAME=${DB_NAME}
ENV DB_USER=${DB_USER}
ENV DB_PASSWORD=${DB_PASSWORD}
ENV DB_HOST=${DB_HOST}
ENV DB_PORT=${DB_PORT}

ENV PYTHONUNBUFFERED 1
ENV PYTHONDONTWRITEBYTECODE 1

RUN apt-get update \
    && apt-get install -y gcc libpq-dev libmariadb-dev pkg-config \
    && rm -rf /var/lib/apt/lists/*



WORKDIR /app

COPY requirements.txt /app/
RUN pip install --upgrade pip && pip install -r requirements.txt
RUN pip install gunicorn


COPY . /app/

EXPOSE 8000


CMD ["gunicorn", "MindedHealth.wsgi:application", "--bind", "0.0.0.0:8000", "--workers", "3", "--timeout", "120"]
